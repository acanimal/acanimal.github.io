---
layout: post
title: Be asynchronous when working with Node
date: 2015-04-09 22:43:39.000000000 +02:00
categories:
- JavaScript
- NodeJS
tags:
- JavaScript
- nodejs
- Tips
- Tricks
status: draft
type: post
published: false
meta:
  _edit_last: '2'
author:
  login: asantiago
  email: asantiago@acuriousanimal.com
  display_name: asantiago
  first_name: Antonio
  last_name: Santiago
excerpt: !ruby/object:Hpricot::Doc
  options: {}
---
<p>Compare</p>
<pre class="lang:js decode:true ">// generating a hash
userSchema.methods.generateHash = function(password) {
  return bcrypt.hashSync(password, bcrypt.genSaltSync(8), null);
};

// checking if password is valid
userSchema.methods.validPassword = function(password) {
  return bcrypt.compareSync(password, this.password);
};</pre>
<p>with this</p>
<pre class="lang:default decode:true ">/**
 * Save hook. Ensures password is hashed
 */
userSchema.pre('save', function(next) {
  var user = this;
  var SALT_FACTOR = 8;

  if (!user.isModified('password')) return next();

  bcrypt.genSalt(SALT_FACTOR, function(err, salt) {
    if (err) return next(err);

    bcrypt.hash(user.password, salt, null, function(err, hash) {
      if (err) return next(err);
      user.password = hash;
      next();
    });
  });
});


/**
 * Validate password
 */
userSchema.methods.comparePassword = function(candidatePassword, cb) {
  bcrypt.compare(candidatePassword, this.password, function(err, isMatch) {
    if (err) {
      return cb(err);
    }
    cb(null, isMatch);
  });
};</pre>
<p>&nbsp;</p>
